<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Consumption Over Time</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            height: 500px;
            transition: all 0.5s ease;
        }
        #lineChartCol {
            flex: 1;
            transition: all 0.5s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #lineChartCol.half-width {
            flex: 1;
        }
        #pieChartCol {
            flex: 0;
            opacity: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: all 0.5s ease, opacity 0.5s ease;
            height: 500px;
        }
        #pieChartCol.active {
            flex: 0.5;
            opacity: 1;
        }
        #pieChart {
            width: 400px;
            height: 400px;
            max-width: 400px;
            max-height: 400px;
        }
    </style>
</head>
<body>

<div class="container-fluid py-4">
    <h2 class="text-center">Energy Consumption Over Time</h2>
    
    <div class="chart-container">
        <!-- Line Chart Column -->
        <div class="chart-container" id="lineChartCol">
            <canvas id="energyChart"></canvas>
        </div>

        <!-- Pie Chart Column, initially hidden and inactive -->
        <div class="chart-container" id="pieChartCol">
            <button id="backButton" class="btn btn-secondary mb-3" style="display: none;">Back</button>
            <canvas id="pieChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/min/moment.min.js"></script>

<script>
    const mainSectorData = {
        labels: ['Maintenance', 'Electricity', 'Services', 'Transport', 'Others'],
        data: [30, 25, 15, 20, 10],
        colors: [
            'rgba(75, 192, 192, 1)', 
            'rgba(255, 206, 86, 1)', 
            'rgba(153, 102, 255, 1)', 
            'rgba(54, 162, 235, 1)', 
            'rgba(255, 99, 132, 1)'
        ]
    };

    const subSectorData = {
        'Maintenance': {
            labels: ['Building & Facility Maintenance', 'Production Equipment Maintenance', 'Infrastructure Maintenance', 'Preventive Maintenance Operations', 'Emergency Repair Services'],
            data: [10, 5, 8, 4, 3],
            timeSeries: [12, 15, 14, 18, 16, 13, 20, 22, 19, 21]
        },
        'Electricity': {
            labels: ['Production Line Power Consumption', 'Facility Climate Control', 'Office & Administrative Power Usage', 'Warehouse & Storage Power', 'Auxiliary Power Systems'],
            data: [12, 7, 4, 1, 1],
            timeSeries: [30, 32, 31, 29, 28, 35, 34, 32, 33, 36]
        },
        'Services': {
            labels: ['Quality Control Services', 'Waste Management Services', 'Technical Support Services', 'Facility Management Services', 'Resource Management Services'],
            data: [3, 4, 2, 3, 3],
            timeSeries: [18, 20, 22, 19, 17, 18, 21, 23, 22, 20]
        },
        'Transport': {
            labels: ['Raw Material Logistics', 'Finished Product Distribution', 'Internal Transport Operations', 'Fleet Management', 'Employee Transport Services'],
            data: [8, 6, 3, 2, 1],
            timeSeries: [25, 27, 26, 24, 23, 22, 21, 20, 19, 18]
        },
        'Others': {
            labels: ['Research & Development Operations', 'Administrative Support', 'Employee Facilities', 'External Support Facilities', 'Temporary Project Operations'],
            data: [2, 3, 1, 1, 3],
            timeSeries: [15, 14, 13, 12, 16, 17, 18, 19, 15, 14]
        }
    };

    let energyChart, pieChart;

    function renderEnergyChart(data = [20, 22, 18, 25, 27, 29, 33, 30, 28, 25], color = 'rgba(54, 162, 235, 1)') {
        const ctx = document.getElementById('energyChart').getContext('2d');
        energyChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct"],
                datasets: [{
                    label: 'Energy Consumption (kWh)',
                    data: data,
                    borderColor: color,
                    backgroundColor: color,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'top' }, title: { display: true, text: 'Energy Consumption Over Time' } },
                scales: { y: { title: { display: true, text: 'Energy Consumption (kWh)' } }, x: { title: { display: true, text: 'Time (Months)' } } },
                onClick: (e, elements) => {
                    if (elements.length > 0) {
                        showMainSectorPieChart();
                    }
                }
            }
        });
    }

    function showMainSectorPieChart() {
        if (pieChart) pieChart.destroy();
        
        document.getElementById('lineChartCol').classList.add('half-width');
        
        const pieChartCol = document.getElementById('pieChartCol');
        pieChartCol.classList.add('active');

        document.getElementById('backButton').style.display = 'none';

        const ctx = document.getElementById('pieChart').getContext('2d');
        pieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: mainSectorData.labels,
                datasets: [{
                    data: mainSectorData.data,
                    backgroundColor: mainSectorData.colors
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: 'Main Sectors of Energy Consumption' }
                },
                onClick: (e, elements) => {
                    if (elements.length > 0) {
                        const sectorIndex = elements[0].index;
                        const sectorLabel = mainSectorData.labels[sectorIndex];
                        const sectorColor = mainSectorData.colors[sectorIndex];
                        showSubSectorPieChart(sectorLabel, sectorColor);
                    }
                }
            }
        });
    }

    function showSubSectorPieChart(sectorLabel, sectorColor) {
        if (pieChart) pieChart.destroy();

        document.getElementById('backButton').style.display = 'block';

        const subData = subSectorData[sectorLabel];
        
        if (energyChart) energyChart.destroy();
        renderEnergyChart(subData.timeSeries, sectorColor);

        const ctx = document.getElementById('pieChart').getContext('2d');
        pieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: subData.labels,
                datasets: [{
                    data: subData.data,
                    backgroundColor: mainSectorData.colors
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: `${sectorLabel} Sub-sectors of Energy Consumption` }
                }
            }
        });
    }

    document.getElementById('backButton').addEventListener('click', () => {
        showMainSectorPieChart();
        if (energyChart) energyChart.destroy();
        renderEnergyChart(); // Reset to default data
    });

    renderEnergyChart();
</script>

</body>
</html>
