<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operational Costs Over Time</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .month-range-picker {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: relative;
            margin-bottom: 20px;
        }
        .picker-display {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
            width: 250px;
            text-align: center;
        }
        .month-picker-container {
            display: none;
            position: absolute;
            top: 50px;
            border: 1px solid #ddd;
            background-color: #fff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        .year-row {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .months-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }
        .month, .year {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            cursor: pointer;
            text-align: center;
        }
        .month.selected, .year.selected {
            background-color: #007bff;
            color: #fff;
        }
        .apply-button {
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
        }
    </style>
</head>
<body>

<div class="container-fluid py-4">
    <h2 class="text-center">Operational Costs Over Time</h2>
    
    <!-- Custom Month & Year Range Picker -->
    <div class="month-range-picker">
        <div class="picker-display" id="monthRangeDisplay">Select Month & Year Range</div>
        <div class="month-picker-container" id="monthPickerContainer">
            <!-- Year and Month Selection -->
            <div id="yearPickerContainer">
                <div class="year-row">
                    <div class="year" data-year="2022">2022</div>
                    <div class="year" data-year="2023">2023</div>
                    <div class="year" data-year="2024">2024</div>
                    <div class="year" data-year="2025">2025</div>
                </div>
            </div>
            <div id="monthPickerContainer" class="months-grid">
                <div class="month" data-month="Jan">Jan</div>
                <div class="month" data-month="Feb">Feb</div>
                <div class="month" data-month="Mar">Mar</div>
                <div class="month" data-month="Apr">Apr</div>
                <div class="month" data-month="May">May</div>
                <div class="month" data-month="Jun">Jun</div>
                <div class="month" data-month="Jul">Jul</div>
                <div class="month" data-month="Aug">Aug</div>
                <div class="month" data-month="Sep">Sep</div>
                <div class="month" data-month="Oct">Oct</div>
                <div class="month" data-month="Nov">Nov</div>
                <div class="month" data-month="Dec">Dec</div>
            </div>
            <div class="apply-button">
                <button class="btn btn-primary btn-sm" id="applyButton">Apply</button>
            </div>
        </div>
    </div>

    <canvas id="costChart"></canvas>
</div>

<!-- Required JS Libraries -->
<script src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>

<script>
    let startSelection = { month: null, year: null };
    let endSelection = { month: null, year: null };

    const monthRangeDisplay = document.getElementById('monthRangeDisplay');
    const monthPickerContainer = document.getElementById('monthPickerContainer');
    const months = document.querySelectorAll('.month');
    const years = document.querySelectorAll('.year');
    const applyButton = document.getElementById('applyButton');

    monthRangeDisplay.addEventListener('click', () => {
        monthPickerContainer.style.display = 'block';
    });

    document.addEventListener('click', (e) => {
        if (!monthPickerContainer.contains(e.target) && e.target !== monthRangeDisplay) {
            monthPickerContainer.style.display = 'none';
        }
    });

    years.forEach(year => {
        year.addEventListener('click', () => {
            const selectedYear = year.dataset.year;
            if (!startSelection.year || (startSelection.year && endSelection.year)) {
                startSelection = { month: null, year: selectedYear };
                endSelection = { month: null, year: null };
            } else {
                endSelection.year = selectedYear;
            }
            highlightRange();
            years.forEach(y => y.classList.remove('selected'));
            year.classList.add('selected');
        });
    });

    months.forEach(month => {
        month.addEventListener('click', () => {
            const selectedMonth = month.dataset.month;
            if (!startSelection.month || (startSelection.month && endSelection.month)) {
                startSelection.month = selectedMonth;
                endSelection.month = null;
                endSelection.year = startSelection.year; 
            } else {
                endSelection.month = selectedMonth;
            }
            highlightRange();
        });
    });

    function clearMonthSelection() {
        months.forEach(m => m.classList.remove('selected'));
    }

    function highlightRange() {
        clearMonthSelection();

        const startDate = moment(`${startSelection.month} ${startSelection.year}`, "MMM YYYY");
        const endDate = endSelection.month
            ? moment(`${endSelection.month} ${endSelection.year}`, "MMM YYYY")
            : startDate;

        months.forEach(month => {
            const currentMonth = month.dataset.month;
            const currentDate = moment(`${currentMonth} ${startSelection.year}`, "MMM YYYY");

            if (
                currentDate.isBetween(startDate, endDate, null, '[]') ||
                currentDate.isSame(startDate) ||
                currentDate.isSame(endDate)
            ) {
                month.classList.add('selected');
            }
        });
    }

    applyButton.addEventListener('click', () => {
        if (startSelection.month && startSelection.year && endSelection.month && endSelection.year) {
            monthRangeDisplay.innerText = `${startSelection.month} ${startSelection.year} - ${endSelection.month} ${endSelection.year}`;
            filterChartData(`${startSelection.month} ${startSelection.year}`, `${endSelection.month} ${endSelection.year}`);
        } else if (startSelection.month && startSelection.year) {
            monthRangeDisplay.innerText = `${startSelection.month} ${startSelection.year} - ${startSelection.month} ${startSelection.year}`;
            filterChartData(`${startSelection.month} ${startSelection.year}`, `${startSelection.month} ${startSelection.year}`);
        } else {
            monthRangeDisplay.innerText = 'Select Month & Year Range';
        }
        monthPickerContainer.style.display = 'none';
    });

    const labels = [
        "Jan 2023", "Feb 2023", "Mar 2023", "Apr 2023", "May 2023", "Jun 2023", "Jul 2023", "Aug 2023", "Sep 2023", "Oct 2023", "Nov 2023", "Dec 2023",
        "Jan 2024", "Feb 2024", "Mar 2024", "Apr 2024", "May 2024", "Jun 2024", "Jul 2024", "Aug 2024", "Sep 2024", "Oct 2024"
    ];
    const operationalCostsData = [30, 28, 26, 24, 22, 20, 18, 16, 19, 21, 23, 25, 27, 29, 26, 24, 22, 20, 18, 16, 14, 12];

    let chart;

    function renderChart(filteredLabels, filteredCosts) {
        if (chart) chart.destroy();

        const data = {
            labels: filteredLabels,
            datasets: [
                { label: 'Operational Costs ($10,000)', data: filteredCosts, borderColor: 'rgba(75, 192, 192, 1)', fill: false }
            ]
        };

        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: { title: { display: true, text: 'Operational Costs Over Time' } },
                scales: { y: { title: { display: true, text: 'Operational Costs ($10,000)' } }, x: { title: { display: true, text: 'Time (Months)' } } }
            }
        };

        chart = new Chart(document.getElementById('costChart').getContext('2d'), config);
    }

    function filterChartData(start, end) {
        const startIdx = labels.indexOf(start);
        const endIdx = labels.indexOf(end);

        const filteredLabels = labels.slice(startIdx, endIdx + 1);
        const filteredCosts = operationalCostsData.slice(startIdx, endIdx + 1);

        renderChart(filteredLabels, filteredCosts);
    }

    renderChart(labels, operationalCostsData);
</script>

</body>
</html>
