<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operational Costs Over Time</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            display: flex;
            flex-wrap: nowrap;
            align-items: center;
            height: 500px;
            transition: all 0.5s ease;
        }
        #lineChartCol {
            flex: 1;
            transition: all 0.5s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #lineChartCol.half-width {
            flex: 1;
        }
        #pieChartCol {
            flex: 0;
            opacity: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease, opacity 0.5s ease;
            height: 500px;
            padding: 10px;
        }
        #pieChartCol.active {
            flex: 0.5;
            opacity: 1;
        }
        #pieChart {
            width: 100%;
            max-width: 400px;
            max-height: 400px;
        }
        #backButton {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="container-fluid py-4">
    <h2 class="text-center">Operational Costs Over Time</h2>
    <div class="chart-container">
        <!-- Line Chart Column -->
        <div class="chart-container" id="lineChartCol">
            <canvas id="costChart"></canvas>
        </div>

        <!-- Pie Chart Column, initially hidden and inactive -->
        <div class="chart-container" id="pieChartCol">
            <button id="backButton" class="btn btn-secondary mb-3" style="display: none;">Back</button>
            <canvas id="pieChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/min/moment.min.js"></script>

<script>
    const mainCostData = {
        labels: ['Labor', 'Materials', 'Equipment', 'Utilities', 'Miscellaneous'],
        data: [35, 25, 20, 15, 5],
        colors: [
            'rgba(75, 192, 192, 1)', 
            'rgba(255, 206, 86, 1)', 
            'rgba(153, 102, 255, 1)', 
            'rgba(54, 162, 235, 1)', 
            'rgba(255, 99, 132, 1)'
        ]
    };

    const subCostData = {
        'Labor': {
            labels: ['Regular Wages', 'Overtime', 'Benefits', 'Contractors', 'Training'],
            data: [15, 5, 8, 4, 3]
        },
        'Materials': {
            labels: ['Raw Materials', 'Office Supplies', 'Packaging', 'Maintenance Supplies', 'Safety Equipment'],
            data: [12, 7, 4, 1, 1]
        },
        'Equipment': {
            labels: ['Machinery', 'IT Equipment', 'Vehicles', 'Tools', 'Furniture'],
            data: [3, 4, 2, 3, 3]
        },
        'Utilities': {
            labels: ['Electricity', 'Water', 'Gas', 'Telecommunications', 'Waste Disposal'],
            data: [8, 6, 3, 2, 1]
        },
        'Miscellaneous': {
            labels: ['Marketing', 'Travel', 'Insurance', 'Legal Fees', 'Misc. Expenses'],
            data: [2, 3, 1, 1, 3]
        }
    };

    let costChart, pieChart;

    function renderCostChart() {
        const ctx = document.getElementById('costChart').getContext('2d');
        costChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [
                    "Jan 2023", "Feb 2023", "Mar 2023", "Apr 2023", "May 2023", "Jun 2023", 
                    "Jul 2023", "Aug 2023", "Sep 2023", "Oct 2023", "Nov 2023", "Dec 2023",
                    "Jan 2024", "Feb 2024", "Mar 2024", "Apr 2024", "May 2024", "Jun 2024", 
                    "Jul 2024", "Aug 2024", "Sep 2024", "Oct 2024"
                ],
                datasets: [{
                    label: 'Operational Costs ($10,000)',
                    data: [30, 28, 26, 24, 22, 20, 18, 16, 19, 21, 23, 25, 27, 29, 26, 24, 22, 20, 18, 16, 14, 12],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    fill: false
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false }, title: { display: true, text: 'Operational Costs Over Time' } },
                scales: { y: { title: { display: true, text: 'Operational Costs ($10,000)' } }, x: { title: { display: true, text: 'Time (Months)' } } },
                onClick: (e, elements) => {
                    if (elements.length > 0) {
                        showMainCostPieChart();
                    }
                }
            }
        });
    }

    function showMainCostPieChart() {
        if (pieChart) pieChart.destroy();
        
        document.getElementById('lineChartCol').classList.add('half-width');
        
        const pieChartCol = document.getElementById('pieChartCol');
        pieChartCol.classList.add('active');

        document.getElementById('backButton').style.display = 'none';

        const ctx = document.getElementById('pieChart').getContext('2d');
        pieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: mainCostData.labels,
                datasets: [{
                    data: mainCostData.data,
                    backgroundColor: mainCostData.colors
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: 'Main Sectors of Operational Costs' }
                },
                onClick: (e, elements) => {
                    if (elements.length > 0) {
                        const sectorIndex = elements[0].index;
                        const sectorLabel = mainCostData.labels[sectorIndex];
                        const sectorColor = mainCostData.colors[sectorIndex];
                        showSubCostPieChart(sectorLabel, sectorColor);
                    }
                }
            }
        });
    }

    function showSubCostPieChart(sectorLabel, sectorColor) {
        if (pieChart) pieChart.destroy();

        document.getElementById('backButton').style.display = 'block';

        const subData = subCostData[sectorLabel];
        
        if (costChart) costChart.destroy();
        renderCostChart(subData.timeSeries, sectorColor);

        const ctx = document.getElementById('pieChart').getContext('2d');
        pieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: subData.labels,
                datasets: [{
                    data: subData.data,
                    backgroundColor: mainCostData.colors
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: `${sectorLabel} Sub-sectors of Operational Costs` }
                }
            }
        });
    }

    document.getElementById('backButton').addEventListener('click', () => {
        showMainCostPieChart();
        if (costChart) costChart.destroy();
        renderCostChart(); // Reset to default data
    });

    renderCostChart();
</script>

</body>
</html>
